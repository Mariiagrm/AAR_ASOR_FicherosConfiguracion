services:
  # ---------------- SERVIDOR CORREO ----------------
  mail:
    build:
      context: ./Correo
      dockerfile: dockerfile
    container_name: dorayaki-mail
    restart: always

    # Puertos expuestos desde el contenedor hacia el host
    ports:
      - "25:25"     # SMTP
      - "587:587"   # Submission (SMTP autenticado con STARTTLS)
      - "143:143"   # IMAP
      #- "993:993"   # IMAPS
      - "110:110"   # POP3
      #- "995:995"   # POP3S

    volumes:
      # Certificados TLS
      - ./Correo/certificados:/certs:ro
      # Persistencia del correo (Maildir)
      - ./Correo/datos-mail:/var/mail/vhosts
      # Logs
      #- ./Correo/logs:/var/log/

    environment:
      TZ: Europe/Madrid


  # ---------------- SERVIDOR DNS ----------------
  bind:
    image: internetsystemsconsortium/bind9:9.20
    container_name: bind_dns
    restart: always

    # BIND debe escuchar directamente en la interfaz del host
    network_mode: host

    volumes:
      - ./dns/bind:/etc/bind      # Configuraci√≥n y zonas
      - bind_cache:/var/cache/bind

volumes:
  bind_cache:
